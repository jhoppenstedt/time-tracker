<table [dataSource]="dataSource" mat-table>
  <ng-container matColumnDef="date">
    <th *matHeaderCellDef mat-header-cell>Date</th>
    <td *matCellDef="let element" mat-cell>
      <ng-container *ngIf="element.edit; else dateField">
        <mat-form-field appearance="standard">
          <input
            [(ngModel)]="element.value['date']"
            name="date"
            [matDatepicker]="picker"
            matInput
            [disabled]="element.value.holiday"
          />
          <mat-datepicker-toggle
            [disabled]="element.value.holiday"
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </ng-container>
      <ng-template #dateField>
        {{ element.value.date | date: 'EE dd. LLLL YY' }}
      </ng-template>
    </td>
  </ng-container>
  <ng-container matColumnDef="time">
    <th *matHeaderCellDef mat-header-cell>Time</th>
    <td *matCellDef="let element" mat-cell>
      <ng-container *ngIf="element.edit; else timeField">
        <mat-form-field appearance="standard" class="time-field">
          <mat-label>Start</mat-label>
          <input
            type="time"
            step="300"
            matInput
            (ngModelChange)="startTimeChanged($event, element.value)"
            [(ngModel)]="element.startString"
            name="start"
            [disabled]="element.value.holiday"
          />
        </mat-form-field>
        <mat-form-field appearance="standard" class="time-field" >
          <mat-label>End</mat-label>
          <input
            type="time"
            step="300"
            matInput
            (ngModelChange)="endTimeChanged($event, element.value)"
            [(ngModel)]="element.endString"
            name="end"
            [disabled]="element.value.holiday"
          />
        </mat-form-field>
      </ng-container>
      <ng-template #timeField>
        <ng-container *ngIf="!element.value.holiday; else dayOff">
          {{ element.value.duration | time }}
        </ng-container>
      </ng-template>
    </td>
  </ng-container>
  <ng-container matColumnDef="pause">
    <th *matHeaderCellDef mat-header-cell>Pause</th>
    <td *matCellDef="let element" mat-cell>
      <ng-container *ngIf="element.edit; else pauseField">
        <mat-form-field appearance="standard">
          <mat-select [(ngModel)]="element.value.pause.minutes" name="pause" [disabled]="element.value.holiday">
            <mat-option
              [value]="pauseTime"
              *ngFor="let pauseTime of pauseOptions"
            >{{ pauseTime }}</mat-option
            >
          </mat-select>
        </mat-form-field>
      </ng-container>
      <ng-template #pauseField>
        <ng-container *ngIf="!element.value.holiday; else dayOff">
          {{ element.value.pause | time }}
        </ng-container>
      </ng-template>
    </td>
  </ng-container>
  <ng-container matColumnDef="real">
    <th *matHeaderCellDef mat-header-cell>Real</th>
    <td *matCellDef="let element" mat-cell>
    <ng-container *ngIf="!element.value.holiday; else dayOff">
      {{ realWorkTime(element.value) }}
    </ng-container>
  </ng-container>
  <ng-container matColumnDef="holiday">
    <th *matHeaderCellDef mat-header-cell>Holiday</th>
    <td mat-cell *matCellDef="let element">
      <mat-checkbox
        [disabled]="element.edit === false"
        [(ngModel)]="element.value.holiday"
      ></mat-checkbox>
    </td>
  </ng-container>
  <ng-container matColumnDef="actions">
    <th *matHeaderCellDef mat-header-cell>Actions</th>
    <td mat-cell *matCellDef="let element">
      <button *ngIf="element.edit !== true; else saveOrCancel" mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      <ng-template #saveOrCancel>
        <button mat-icon-button (click)="saveRow(element)">
          <mat-icon>save</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEdit(element)">
          <mat-icon>close</mat-icon>
        </button>
      </ng-template>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="editRow(element)">
          <mat-icon>edit</mat-icon>
          <span>Edit</span>
        </button>
        <button mat-menu-item (click)="deleteRow(element)">
          <mat-icon>delete</mat-icon>
          <span>Delete</span>
        </button>
      </mat-menu>
    </td>
  </ng-container>

  <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
  <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
</table>
<ng-template #dayOff>-</ng-template>
