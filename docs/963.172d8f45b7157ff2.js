"use strict";(self.webpackChunktime_tracker=self.webpackChunktime_tracker||[]).push([[963],{963:(Rt,L,f)=>{f.r(L),f.d(L,{BackupComponent:()=>wt});var o=f(4650),j=f(7579),W=f(8675),O=f(3900),Y=f(9751),U=f(8421);const{isArray:Q}=Array;var _=f(515),w=f(5403),tt=f(3269);var nt=f(9300),d=f(4004),rt=f(4482);function R(t,a){return a?e=>e.pipe(R((n,r)=>(0,U.Xf)(t(n,r)).pipe((0,d.U)((c,i)=>a(n,c,r,i))))):(0,rt.e)((e,n)=>{let r=0,c=null,i=!1;e.subscribe((0,w.x)(n,u=>{c||(c=(0,w.x)(n,void 0,()=>{c=null,i&&n.complete()}),(0,U.Xf)(t(u,r++)).subscribe(c))},()=>{i=!0,!c&&n.complete()}))})}var at=f(4128),ot=f(8505),ct=f(6451),it=f(2940),T=f(4859),ut=f(7735);function v(t){return"[object Array]"===Object.prototype.toString.call(t)}function N(t,a){if(!t)throw new Error(a)}function E(t){return Object.keys(t)}function g(t){return Object.keys(t).map(function(a){return[a,t[a]]})}function m(t,a,e){var n="."+a,r=new RegExp("(\\".concat(a,")?$"));return e(t).replace(r,n)}function J(t,a,e,n){void 0===e&&(e="download"),void 0===n&&(n=!0);var r=function pt(t,a,e){switch(a){case"txt":var n="text/plain;charset=utf-8";return e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);case"css":return n="text/css;charset=utf-8",e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);case"html":return n="text/html;charset=utf-8",e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);case"json":return n="text/json;charset=utf-8",e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);case"csv":return n="text/csv;charset=utf-8",e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);case"xls":return n="text/application/vnd.ms-excel;charset=utf-8",e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);case"xml":return n="text/application/xml;charset=utf-8",e?URL.createObjectURL(new Blob([t],{type:n})):"data:,".concat(n)+encodeURIComponent(t);default:return""}}(t,a,n),c=document.createElement("a");c.href=r,c.download=e,c.setAttribute("style","visibility:hidden"),document.body.appendChild(c),c.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!1,view:window})),document.body.removeChild(c)}var S=function(){return S=Object.assign||function(t){for(var a,e=1,n=arguments.length;e<n;e++)for(var r in a=arguments[e])Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r]);return t},S.apply(this,arguments)},b=function(t,a){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,i,n=e.call(t),c=[];try{for(;(void 0===a||a-- >0)&&!(r=n.next()).done;)c.push(r.value)}catch(u){i={error:u}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(i)throw i.error}}return c};function D(t){return t.map(g).reduce(function(a,e,n){return e.reduce(function(r,c){var i=b(c,2),u=i[0],l=i[1],s=r[u]||Array.from({length:t.length}).map(function(p){return""});return s[n]=("string"!=typeof l?JSON.stringify(l):l)||"",r[u]=s,r},a)},Object.create(null))}function F(t,a){return void 0===a&&(a=function(e){return e}),a(g(t).map(function(e){var n=b(e,2);return{fieldName:n[0],fieldValues:n[1]}}))}function ht(t){var a=/,|"|\n/.test(t)?'"':"",e=t.replace(/"/g,'""');return"".concat(a).concat(e).concat(a)}function yt(t){return'<?xml version="1.0" encoding="utf-8"?><!DOCTYPE base>\n'.concat(A(t,"base"),"\n")}function A(t,a,e,n){void 0===e&&(e="element"),void 0===n&&(n=0);var r=function lt(t){return"555xmlHello .  world!".trim().replace(/^([0-9,;]|(xml))+/,""),t.replace(/[^_a-zA-Z 0-9:\-\.]/g,"").replace(/^([ 0-9-:\-\.]|(xml))+/i,"").replace(/ +/g,"-")}(a),c=function st(t){return Array(t+1).join(" ")}(n);if(null==t)return"".concat(c,"<").concat(r," />");var i=v(t)?t.map(function(l){return A(l,e,e,n+2)}).join("\n"):"object"==typeof t?g(t).map(function(l){var s=b(l,2);return A(s[1],s[0],e,n+2)}).join("\n"):c+"  "+function ft(t){return t.replace(/([<>&])/g,function(a,e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return""}})}(String(t));return"".concat(c,"<").concat(r,">\n").concat(i,"\n").concat(c,"</").concat(r,">")}function C(t){var a=t.data,e=t.fileName,n=void 0===e?"download":e,r=t.extension,c=t.fileNameFormatter,i=void 0===c?function(M){return M.replace(/\s+/,"_")}:c,u=t.fields,l=t.exportType,s=void 0===l?"txt":l,p=t.replacer,I=void 0===p?null:p,B=t.space,Nt=void 0===B?4:B,V=t.processor,h=void 0===V?J:V,P=t.withBOM,At=void 0!==P&&P,X=t.beforeTableEncode,G=void 0===X?function(M){return M}:X,H="Invalid export data. Please provide an array of objects",Ct="Can't export unknown data type ".concat(s,"."),It="Can't export string data to ".concat(s,".");if("string"==typeof a)switch(s){case"txt":case"css":case"html":return h(a,s,m(n,r??s,i));default:throw new Error(It)}var Mt=function dt(t){if(!t||v(t)&&!t.length||!v(t)&&!E(t).length)return function(e){return e};var a=v(t)?t.reduce(function(e,n){var r;return S(S({},e),((r={})[n]=n,r))},Object.create(null)):t;return function(e){return v(e)?e.map(function(n){return g(n).reduce(function(r,c){var i=b(c,2),u=i[0];return u in a&&(r[a[u]]=i[1]),r},Object.create(null))}).filter(function(n){return E(n).length}):g(e).reduce(function(n,r){var c=b(r,2),i=c[0];return i in a&&(n[a[i]]=c[1]),n},Object.create(null))}}(u),x=Mt(function vt(t){try{return"string"==typeof t?JSON.parse(t):t}catch{throw new Error("Invalid export data. Please provide a valid JSON")}}(a)),K=function mt(t,a,e){void 0===a&&(a=null);try{return JSON.stringify(t,a,e)}catch{throw new Error("Invalid export data. Please provide valid JSON object")}}(x,I,Nt);switch(s){case"txt":case"css":case"html":return h(K,s,m(n,r??s,i));case"json":return h(K,s,m(n,r??"json",i));case"csv":N(v(x),H);var z=function xt(t,a){if(void 0===a&&(a=function(u){return u}),!t.length)return"";var n=F(D(t),a);return n.map(function(u){return u.fieldName}).join(",")+"\r\n"+n.map(function(u){return u.fieldValues}).map(function(u){return u.map(ht)}).reduce(function(u,l){return u.map(function(s,p){return"".concat(s,",").concat(l[p])})}).join("\r\n")}(x,G);return h(At?"\ufeff"+z:z,s,m(n,r??"csv",i));case"xls":return N(v(x),H),h(function bt(t,a){if(void 0===a&&(a=function(n){return n}),!t.length)return"";var e='<html>\n  <head>\n    <meta charset="UTF-8" />\n  </head >\n  <body>\n    '.concat(function gt(t,a){N(t.length>0);var n=F(D(t),a),r=n.map(function(u){return u.fieldName}).join("</b></th><th><b>"),i=n.map(function(u){return u.fieldValues}).map(function(u){return u.map(function(l){return"<td>".concat(l,"</td>")})}).reduce(function(u,l){return u.map(function(s,p){return"".concat(s).concat(l[p])})});return"\n    <table>\n      <thead>\n        <tr><th><b>".concat(r,"</b></th></tr>\n      </thead>\n      <tbody>\n        <tr>").concat(i.join("</tr>\n        <tr>"),"</tr>\n      </tbody>\n    </table>\n  ")}(t,a),"\n  </body>\n</html >\n");return e}(x,G),s,m(n,r??"xls",i));case"xml":return h(yt(x),s,m(n,r??"xml",i));default:throw new Error(Ct)}}C.types={txt:"txt",css:"css",html:"html",json:"json",csv:"csv",xls:"xls",xml:"xml"},C.processors={downloadFile:J};const jt=C;var Ot=f(284),Z=f(3336),k=f(7009),$=f(6895);function Ut(t,a){if(1&t){const e=o.EpF();o.TgZ(0,"div",1)(1,"div")(2,"h3",2),o._uU(3,"Export"),o.qZA(),o.TgZ(4,"p",3),o._uU(5,"Save your data into a JSON file and download it."),o.qZA(),o.TgZ(6,"button",4),o.NdJ("click",function(){o.CHM(e);const r=o.oxw();return o.KtG(r.exportData())}),o._uU(7," Export "),o.qZA()(),o.TgZ(8,"div")(9,"h3",5),o._uU(10,"Import"),o.qZA(),o.TgZ(11,"input",6,7),o.NdJ("change",function(r){o.CHM(e);const c=o.oxw();return o.KtG(c.handleFileChange(r))}),o.qZA(),o.TgZ(13,"div",8)(14,"span",9),o._uU(15),o.qZA(),o.TgZ(16,"button",10),o.NdJ("click",function(){o.CHM(e);const r=o.MAs(12);return o.KtG(r.click())}),o.TgZ(17,"mat-icon"),o._uU(18,"upload_file"),o.qZA()()(),o.TgZ(19,"button",11),o.NdJ("click",function(){o.CHM(e);const r=o.oxw();return o.KtG(r.importData())}),o._uU(20," Import "),o.qZA()()()}if(2&t){const e=a.ngIf;o.xp6(15),o.Oqu(e.fileName||"Choose file"),o.xp6(4),o.Q6J("disabled",e.disableImport)}}let wt=(()=>{class t{constructor(){this.snackbarService=(0,o.f3M)(k.ux),this.workTimeService=(0,o.f3M)(ut.g),this.exportSubject=new j.x,this.fileSubject=new j.x,this.importSubject=new j.x,this.fileName$=this.fileSubject.pipe((0,d.U)(e=>e?.name??"")),this.disableImport$=this.fileSubject.pipe((0,d.U)(e=>null==e),(0,W.O)(!0)),this.export$=this.exportSubject.asObservable().pipe((0,O.w)(()=>this.workTimeService.find()),(0,d.U)(e=>this.export(e))),this.import$=function et(...t){const a=(0,tt.jO)(t),e=function q(t){return 1===t.length&&Q(t[0])?t[0]:t}(t);return e.length?new Y.y(n=>{let r=e.map(()=>[]),c=e.map(()=>!1);n.add(()=>{r=c=null});for(let i=0;!n.closed&&i<e.length;i++)(0,U.Xf)(e[i]).subscribe((0,w.x)(n,u=>{if(r[i].push(u),r.every(l=>l.length)){const l=r.map(s=>s.shift());n.next(a?a(...l):l),r.some((s,p)=>!s.length&&c[p])&&n.complete()}},()=>{c[i]=!0,!r[i].length&&n.complete()}));return()=>{r=c=null}}):_.E}([this.importSubject,this.fileSubject.pipe((0,nt.h)(e=>null!=e))]).pipe((0,O.w)(([,e])=>e.text()),(0,O.w)(e=>this.parseJson(e)),R(e=>(0,at.D)(e.map(n=>(delete n.id,n.date=new Date(n.date),this.workTimeService.insert(n))))),(0,d.U)(e=>e.length),(0,ot.b)(e=>{this.snackbarService.open(`Imported ${e} entries successfully`)})),this.viewModel$=(0,ct.T)(this.fileName$.pipe((0,d.U)(e=>({fileName:e}))),this.disableImport$.pipe((0,d.U)(e=>({disableImport:e}))),this.export$.pipe((0,d.U)(()=>({}))),this.import$.pipe((0,d.U)(()=>({fileName:"",disableImport:!0})))).pipe((0,it.R)((e,n)=>({...e,...n}),{disableImport:!0,fileName:""}))}exportData(){this.exportSubject.next()}importData(){this.importSubject.next()}handleFileChange(e){const n=e.target.files?.[0];n&&this.fileSubject.next(n)}export(e){jt({data:e,fileName:"timetracker-db",exportType:"json",fileNameFormatter:n=>`${(new Date).toLocaleDateString()}-${n}`})}parseJson(e){return new Promise((n,r)=>{try{n(JSON.parse(e))}catch(c){c instanceof Error&&this.snackbarService.open(c.message,"Dismiss"),r(c)}})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["ng-component"]],standalone:!0,features:[o.jDz],decls:2,vars:3,consts:[["class","flex flex-col gap-4",4,"ngIf"],[1,"flex","flex-col","gap-4"],[1,"text-lg","mb-4"],[1,"mb-2"],["mat-raised-button","","color","primary",3,"click"],[1,"text-lg","my-4"],["type","file",1,"hidden",3,"change"],["fileUpload",""],[1,"my-2"],[1,"mr-2"],["mat-mini-fab","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(e,n){1&e&&(o.YNc(0,Ut,21,2,"div",0),o.ALo(1,"async")),2&e&&o.Q6J("ngIf",o.lcZ(1,1,n.viewModel$))},dependencies:[T.ot,T.lW,Ot.c,Z.Ps,Z.Hw,k.ZX,$.Ov,$.O5],encapsulation:2,changeDetection:0}),t})()}}]);